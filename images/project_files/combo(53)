YUI.add("hermes-template-follow",(function(n,l){var t=n.Template.Handlebars.revive({1:function(n,l,t,o,e){var r,a=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(r=a(t,"if").call(null!=l?l:n.nullContext||{},null!=l?a(l,"showNoButton"):l,{name:"if",hash:{},fn:n.program(2,e,0),inverse:n.program(4,e,0),data:e,loc:{start:{line:2,column:1},end:{line:14,column:8}}}))?r:""},2:function(n,l,t,o,e){return""},4:function(n,l,t,o,e){var r,a=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(r=a(t,"if").call(null!=l?l:n.nullContext||{},null!=l?a(l,"showUnblockButton"):l,{name:"if",hash:{},fn:n.program(5,e,0),inverse:n.program(7,e,0),data:e,loc:{start:{line:5,column:2},end:{line:13,column:9}}}))?r:""},5:function(n,l,t,o,e){var r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return"\t\t\t<button class='follow alt'>"+n.escapeExpression((r(t,"intlMessage")||l&&r(l,"intlMessage")||n.hooks.helperMissing).call(null!=l?l:n.nullContext||{},{name:"intlMessage",hash:{intlName:"common.UNBLOCK"},data:e,loc:{start:{line:6,column:30},end:{line:6,column:71}}}))+"</button>\n"},7:function(n,l,t,o,e){var r,a=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(r=a(t,"if").call(null!=l?l:n.nullContext||{},null!=l?a(l,"showFollowingButton"):l,{name:"if",hash:{},fn:n.program(8,e,0),inverse:n.program(10,e,0),data:e,loc:{start:{line:8,column:3},end:{line:12,column:10}}}))?r:""},8:function(n,l,t,o,e){return'\t\t\t\t<button class="follow is-following mini"><span class="drop-icon">▾</span></button>\n'},10:function(n,l,t,o,e){return'\t\t\t\t<button class="follow mini"></button>\n'},12:function(n,l,t,o,e){var r,a=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(r=a(t,"if").call(null!=l?l:n.nullContext||{},null!=l?a(l,"showNoButton"):l,{name:"if",hash:{},fn:n.program(2,e,0),inverse:n.program(13,e,0),data:e,loc:{start:{line:16,column:1},end:{line:28,column:8}}}))?r:""},13:function(n,l,t,o,e){var r,a=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(r=a(t,"if").call(null!=l?l:n.nullContext||{},null!=l?a(l,"showUnblockButton"):l,{name:"if",hash:{},fn:n.program(5,e,0),inverse:n.program(14,e,0),data:e,loc:{start:{line:19,column:2},end:{line:27,column:9}}}))?r:""},14:function(n,l,t,o,e){var r,a=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(r=a(t,"if").call(null!=l?l:n.nullContext||{},null!=l?a(l,"showFollowingButton"):l,{name:"if",hash:{},fn:n.program(15,e,0),inverse:n.program(18,e,0),data:e,loc:{start:{line:22,column:3},end:{line:26,column:10}}}))?r:""},15:function(n,l,t,o,e){var r,a=null!=l?l:n.nullContext||{},u=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t\t\t<button class="follow is-following '+(null!=(r=u(t,"if").call(a,null!=l?u(l,"isOnDark"):l,{name:"if",hash:{},fn:n.program(16,e,0),inverse:n.noop,data:e,loc:{start:{line:23,column:39},end:{line:23,column:67}}}))?r:"")+'">'+n.escapeExpression((u(t,"intlMessage")||l&&u(l,"intlMessage")||n.hooks.helperMissing).call(a,{name:"intlMessage",hash:{intlName:null!=l?u(l,"followingIntlKey"):l},data:e,loc:{start:{line:23,column:69},end:{line:23,column:110}}}))+'<span class="drop-icon">▾</span></button>\n'},16:function(n,l,t,o,e){return"white"},18:function(n,l,t,o,e){var r,a=null!=l?l:n.nullContext||{},u=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t\t\t<button class="follow '+(null!=(r=u(t,"if").call(a,null!=l?u(l,"isOnDark"):l,{name:"if",hash:{},fn:n.program(16,e,0),inverse:n.noop,data:e,loc:{start:{line:25,column:26},end:{line:25,column:54}}}))?r:"")+'">'+n.escapeExpression((u(t,"intlMessage")||l&&u(l,"intlMessage")||n.hooks.helperMissing).call(a,{name:"intlMessage",hash:{intlName:null!=l?u(l,"followIntlKey"):l},data:e,loc:{start:{line:25,column:56},end:{line:25,column:94}}}))+"</button>\n"},compiler:[8,">= 4.3.0"],main:function(n,l,t,o,e){var r,a=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(r=a(t,"if").call(null!=l?l:n.nullContext||{},null!=l?a(l,"isOnMobile"):l,{name:"if",hash:{},fn:n.program(1,e,0),inverse:n.program(12,e,0),data:e,loc:{start:{line:1,column:0},end:{line:29,column:7}}}))?r:""},useData:!0}),o={};n.Array.each([],(function(l){var t=n.Template.get("hermes/"+l);t&&(o[l]=t)})),n.Template.register("hermes/follow",(function(l,e){return(e=e||{}).partials=e.partials?n.merge(o,e.partials):o,t(l,e)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-following-dropdown",(function(e,n){var l=e.Template.Handlebars.revive({1:function(e,n,l,t,a){return'\t\t\t<label class = "checked">\n\t\t\t\t<input type="checkbox" checked="checked" id="friend-checkbox" />\n'},3:function(e,n,l,t,a){return'\t\t\t<label>\n\t\t\t\t<input type="checkbox" id="friend-checkbox" />\n'},5:function(e,n,l,t,a){return'\t\t\t<label class="checked">\n\t\t\t\t<input type="checkbox" checked="checked" id="family-checkbox" />\n'},7:function(e,n,l,t,a){return'\t\t\t<label>\n\t\t\t\t<input type="checkbox" id="family-checkbox" />\n'},compiler:[8,">= 4.3.0"],main:function(e,n,l,t,a){var i,o=null!=n?n:e.nullContext||{},c=e.hooks.helperMissing,s=e.escapeExpression,r=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'<ul>\n\t<li class="following-friend">\n'+(null!=(i=r(l,"if").call(o,null!=n?r(n,"isFriend"):n,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.program(3,a,0),data:a,loc:{start:{line:3,column:2},end:{line:9,column:9}}}))?i:"")+"\t\t\t"+s((r(l,"intlMessage")||n&&r(n,"intlMessage")||c).call(o,{name:"intlMessage",hash:{intlName:"common.FRIEND"},data:a,loc:{start:{line:10,column:3},end:{line:10,column:43}}}))+'\n\t\t</label>\n\t</li>\n\t<li class="following-family">\n'+(null!=(i=r(l,"if").call(o,null!=n?r(n,"isFamily"):n,{name:"if",hash:{},fn:e.program(5,a,0),inverse:e.program(7,a,0),data:a,loc:{start:{line:14,column:2},end:{line:20,column:9}}}))?i:"")+"\t\t\t"+s((r(l,"intlMessage")||n&&r(n,"intlMessage")||c).call(o,{name:"intlMessage",hash:{intlName:"common.FAMILY"},data:a,loc:{start:{line:21,column:3},end:{line:21,column:43}}}))+'\n\t\t</label>\n\t</li>\n\t<li class="divider"></li>\n\t<li class="following-unfollow">\n\t\t<button class="follow unfollow">'+s((r(l,"intlMessage")||n&&r(n,"intlMessage")||c).call(o,{name:"intlMessage",hash:{intlName:"common.UNFOLLOW"},data:a,loc:{start:{line:26,column:34},end:{line:26,column:76}}}))+"</button>\n\t</li>\n</ul>"},useData:!0}),t={};e.Array.each([],(function(n){var l=e.Template.get("hermes/"+n);l&&(t[n]=l)})),e.Template.register("hermes/following-dropdown",(function(n,a){return(a=a||{}).partials=a.partials?e.merge(t,a.partials):t,l(n,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("relationship-menu-view",(function(i,e){var n=require("hermes-core/flog")(e);i.FlickrView.create(this.name,i.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(i){return this.nsid=i.nsid,this.pathAlias=i.pathAlias,this.disableRefreshOnRelationshipChange=i.disableRefreshOnRelationshipChange,""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this},loadState:function(){var i=this,e=i.nsid||{pathAlias:i.pathAlias};return i.appContext.getModel("person-relationship-models",e).then((function(e){i.relationship=e,i.nsid=i.nsid||e.id}))},buildContainer:function(){return this.setContainerWithTemplate("following-dropdown",{isFriend:this.relationship.getValue("isFriend"),isFamily:this.relationship.getValue("isFamily")}),this},activate:function(){var i=this.get("container"),e=this;return this.relationship&&this.registerEventHandler(this.relationship.on("valuesChanged",(function(){e.buildContainer()}))),this.registerEventHandler(i.delegate("click",(function(i){e.handleUnfollowClick(i)}),".following-unfollow")),this.registerEventHandler(i.delegate("change",(function(i){e.handleFriendChange(i)}),".following-friend input")),this.registerEventHandler(i.delegate("change",(function(i){e.handleFamilyChange(i)}),".following-family input")),this},handleUnfollowClick:function(e){var t=this;e.preventDefault(),this.relationship.getValue("isContact")&&(this.relationship.registry.toggleFollowing(this.nsid),this.relationship.registry.remoteUpdate(this.nsid).then((function(){t.disableRefreshOnRelationshipChange||i.config.win.location.reload()}),(function(i){t.relationship.setValue("isContact",!0),t.buildContainer(),n.error({err:i})})),i.rapidTracker.beacon(this.name,"unfollowButtonClick"),this.fire("onUnfollow"))},handleFriendChange:function(e){var t=this;this.relationship.registry.toggleFriend(this.nsid),this.relationship.registry.remoteUpdate(this.nsid).then((function(){t.disableRefreshOnRelationshipChange||i.config.win.location.reload()}),(function(i){t.relationship.registry.toggleFriend(t.nsid),t.buildContainer(),t.onError(t.intlMessage({intlName:"person.RELATIONSHIP_FRIEND_ERROR"})),n.error({err:i})}))},handleFamilyChange:function(e){var t=this;this.relationship.registry.toggleFamily(this.nsid),this.relationship.registry.remoteUpdate(this.nsid).then((function(){t.disableRefreshOnRelationshipChange||i.config.win.location.reload()}),(function(i){t.relationship.registry.toggleFamily(t.nsid),t.buildContainer(),t.onError(t.intlMessage({intlName:"person.RELATIONSHIP_FAMILY_ERROR"})),n.error({err:i})}))}})}),"@VERSION@",{requires:["promise","hermes-template-following-dropdown"],optionalRequires:["hermes-core"],langBundles:["common","person"]});YUI.add("hermes-lang-person_zh-hk",(function(e,O){e.Intl.add("hermes/person","zh-HK",{MESSAGE:[{type:0,value:"訊息"}],ALBUMS:[{type:0,value:"相簿"}],FAVES:[{type:0,value:"最愛"}],PROFILE:[{type:0,value:"個人檔案"}],NO_PHOTOS:[{type:0,value:"此使用者沒有可檢視的相片。"}],NO_LONGER_ON_FLICKR:[{type:0,value:"無此使用者，或此使用者已不再使用 Flickr。"}],ERROR_LOADING:[{type:0,value:"載入使用者卡片時發生錯誤。 請再試一次。"}],RELATIONSHIP_FRIEND_ERROR:[{type:0,value:"設定朋友關係時發生問題。"}],RELATIONSHIP_FAMILY_ERROR:[{type:0,value:"設定家人關係時發生問題。"}],SIGN_IN_BEFORE_FOLLOW_TITLE:[{type:0,value:"你找到追蹤對象！"}],SIGN_IN_BEFORE_FOLLOW_MESSAGE:[{type:0,value:"太好了。 請登入並追蹤他們。"}],JOIN_FLICKR_AND_FOLLOW:[{type:0,value:"加入 Flickr，即可隨時隨地瀏覽 "},{type:1,value:"person"},{type:0,value:" 發佈的內容。"}],SIGN_IN_AND_FOLLOW:[{type:0,value:"登入並追蹤"}],CURATOR_PASS_OVER:[{type:0,value:"略過"}],CURATOR_PASS_OVER_UNDO:[{type:0,value:"取消略過"}]})}),"@VERSION@",{requires:["intl"]});YUI.add("follow-view",(function(e,i){var n=require("hermes-core/flog")(i);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.set("isActiveViewAgnostic",e.isActiveViewAgnostic),this.nsid=e.nsid,this.pathAlias=e.pathAlias,this.realFullscreen=!!e.realFullscreen,this.isOnDark=e.isOnDark,this.disableRefreshOnRelationshipChange=e.disableRefreshOnRelationshipChange,this.isOnMobile=e.isOnMobile,this.additionalDroparoundConfig=e.additionalDroparoundConfig||{},""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this},loadState:function(){var e=this,i=e.nsid||{pathAlias:e.pathAlias};return e.appContext.getModel("person-relationship-models",i).then((function(i){e.set("relationship",i),e.nsid=e.nsid||i.id}))},buildContainer:function(){var e=this.get("relationship");return this.setContainerWithTemplate("follow",{showNoButton:e.getValue("isMe")||e.getValue("isIgnoredBy"),showUnblockButton:e.getValue("isIgnored"),showFollowingButton:e.getValue("isContact"),signedIn:this.appContext.getViewer().signedIn,isOnMobile:this.isOnMobile,isOnDark:this.isOnDark,followIntlKey:"common.FOLLOW",followingIntlKey:"common.FOLLOWING"}),this},activate:function(){var i,t,o,s=this,l=this.get("container"),a=this.get("relationship");return a.getValue("isMe")||this.registerEventHandler(l.delegate("click",(function(l){s.fire("buttonClick"),e.rapidTracker.beacon(this.name,"followButtonClick"),i=l.target.hasClass("follow")?l.target:l.target.ancestor(".follow"),s.appContext.getViewer().signedIn?a.getValue("isIgnored")?(a.registry.toggleIgnore(s.nsid),s.disableRefreshOnRelationshipChange?s.buildContainer():s.showBalls(),a.registry.remoteUpdate(s.nsid).then((function(){s.disableRefreshOnRelationshipChange||e.config.win.location.reload()}),(function(e){a.setValue("isIgnored",!0),s.buildContainer(),n.error({err:e})}))):a.getValue("isContact")?(i.addClass("is-open"),t&&t.destroy(),o=Object.assign({appContext:s.appContext,dismissOnOverlayClick:!0,closeOnScroll:!0,showDropArrow:!0,width:140,height:130,observePageResize:!0,anchorElement:i.one(".drop-icon"),subview:new e.Views["relationship-menu-view"]({nsid:s.nsid,pathAlias:s.pathAlias,disableRefreshOnRelationshipChange:s.disableRefreshOnRelationshipChange}),preferLeft:!0},s.additionalDroparoundConfig),(t=new e.Views.FluidDroparound(o)).on("closeDroparound",(function(){i.removeClass("is-open"),s.fire("subviewViewEvent","isClosed")})),t.show(),s.fire("subviewViewEvent","isOpen"),t.get("subview").on("onUnfollow",(function(){t.close(),t.destroy(),s.disableRefreshOnRelationshipChange?s.buildContainer():s.showBalls()}))):s.followPerson():s.showSignUpModal()}),"button.follow")),s},followPerson:function(){var i=this,t=this.get("relationship");t.getValue("isContact")||(t.registry.toggleFollowing(this.nsid),e.Snowplough&&e.Snowplough.sendStructuredEvent({category:"relationship_change",action:"follow",value:parseInt(this.nsid,10)}),i.disableRefreshOnRelationshipChange?this.buildContainer():this.showBalls(),t.registry.remoteUpdate(this.nsid).then((function(){i.disableRefreshOnRelationshipChange||e.config.win.location.reload()}),(function(e){i.hideBalls(),t.setValue("isContact",!1),i.buildContainer(),n.error({err:e})})))},showBalls:function(){this.balls||(this.balls=e.Node.create(this.templates("flickr-balls")({}))),this.get("container").append(this.balls),this.balls.show(),this.get("container").one(".follow").hide()},hideBalls:function(){this.balls&&(this.balls.remove(),this.get("container").one(".follow").show())},onError:function(i){new e.Views.FluidModal({appContext:this.appContext,subview:new e.Views["confirmation-dialog-view"]({appContext:this.appContext,title:this.intlMessage({intlName:"common.OOPS"}),htmlMessage:i,showCancelButton:!1}),hasSubviewConfigRefactor:!0}).show()},showSignUpModal:function(){var i=this;this.appContext.getModel("person-models",this.nsid).then((function(n){var t,o=i.pathAlias?e.url("/photos/")+i.pathAlias:e.url("/photos/")+i.nsid,s=i.intlMessage({intlName:"person.JOIN_FLICKR_AND_FOLLOW",person:n.getValue("displayname")}),l=n.getValue("buddyicon");l.displayUrl=l.retina||l.large||l.medium||l.default,(t=new e.Views.SignUpModal({appContext:i.appContext,signUpHeaderClass:"avatar person large no-menu no-edit",signUpHeaderImage:l.displayUrl,signUpTitle:i.intlMessage({intlName:"person.SIGN_IN_BEFORE_FOLLOW_TITLE"}),signUpMessage:s,beaconPrefix:"follow"})).on("signUpClick",(function(n){e.SigninHelper.signUpPendingFollow({id:i.nsid},{postLoginUrl:o})})),t.on("signInClick",(function(n){e.SigninHelper.addPendingFollow({id:i.nsid},{postLoginUrl:o})})),t.show()}))}})}),"@VERSION@",{requires:["flickr-view","hermes-template-follow","promise","fluid-droparound-view","fluid-modal-view","signup-modal-view","hermes-template-following-dropdown","hermes-template-flickr-balls","relationship-menu-view","signin-helper","url"],optionalRequires:["hermes-core"],optional:["person-models","person-relationship-models"],langBundles:["common","person"]});YUI.add("attribution-view",(function(e){var i=new e.SubscriptionsHelper;e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{"follow-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(){return this.hideFollowView}}},initializer:function(e){return this.nsid=e.nsid,this.albumPhotoListLayoutStyle=e.albumPhotoListLayoutStyle,this.realFullscreen=!!e.realFullscreen,this.hideFollowView=!!e.hideFollowView&&e.hideFollowView,this.isAlbumView=e.isAlbumView,this.parentViewName=e.parentViewName||!1,this},loadState:function(){var e=this;return this.appContext.getModel("person-models",this.nsid).then((function(i){e.set("owner",i)}))},buildContainer:function(){var e,t=this.get("owner"),n=this.get("container"),a=t.getValue("pathAlias")||t.getValue("nsid");return"justified"===this.albumPhotoListLayoutStyle&&n.addClass("justified-album-details-page"),e=t.getValue("buddyicon").large?t.getValue("buddyicon").large:t.getValue("buddyicon").default,this.setContainerWithTemplate("attribution",{isPro:t.getValue("isPro"),proBadge:t.getValue("proBadge"),pathAlias:a,buddyicon:e,nsid:t.getValue("nsid"),displayname:t.getValue("displayname"),username:t.getValue("username"),parentViewName:this.parentViewName,realFullscreenEnabled:this.realFullscreen&&this.appContext.experiments.fullscreen.getMode(),isAlbumView:this.isAlbumView,upgradeProLink:i.getProLandingPageUrl(i.UTM_PRO_BADGE,{utm_medium:this.name})}),this},activate:function(){return this}})}),"@VERSION@",{requires:["flickr-view","hermes-template-attribution","promise","follow-view","subscriptions-helper"],optional:["person-models"],langBundles:["attribution","common"]});YUI.add("album-header-view",(function(e,t){var i=require("hermes-core/flog")(t),a={headerContent:".album-header-content"};e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.albumId=e.albumId,this.albumPhotoListLayoutStyle=e.albumPhotoListLayoutStyle,""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this},subviewConfig:{"album-title-desc-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"album-stats-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"album-engagement-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"attribution-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,hideFollowView:!0,additionalViewClasses:["album-attribution"],isAlbumView:!0}},loadState:function(){var t=this,i=[];return i.push(this.appContext.getModel("set-models",this.albumId)),this.appContext.getViewer().signedIn&&i.push(this.appContext.getModel("person-preferences-models",this.appContext.getViewer().nsid)),e.Promise.all(i).then((function(e){t.set("albumModel",e[0]),e[1]&&t.set("personPreferenceModel",e[1])}))},buildContainer:function(){var e,t=this.get("container"),a=this.getAlbumHeaderHeight()-60,n=this.get("albumModel"),o=this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid===n.getValue("owner").id,s=this.appContext.viewportData.getDevicePixelRatio(),l=n.getValue("totalCount")<500;return"justified"===this.albumPhotoListLayoutStyle&&(t.addClass("justified-transitions"),t.addClass("justified"),a=300),(e=n.registry.getSizeToFit(this.albumId,{width:.8*this.appContext.viewportData.getWidth()*s,height:a*s}))||i.error("Failed to load album coverphoto."),this.setContainerWithTemplate("album-header",{height:a,"cover-photo-url":e?e.url:"",viewerIsOwner:o,sortEnabled:l}),this},buildErrorContainer:function(){},activate:function(){var t,i=this,n=this.get("container"),o=n.one(".edit-cover-photo"),s=n.one(".album-header-content"),l=n.one(".avatar"),r=this.get("personPreferenceModel");if(this.albumHeaderElement=this.get("container").one(a.headerContent),this.registerEventHandler(e.globalEvents.subscribe("window:resize",this.resizeHeader.bind(this))),o&&this.registerEventHandler(o.on("click",this.handleSetCoverPhotoClick.bind(this))),this.appContext.flipper.isFlipped("enable-change-album-sorting")){var h=this.get("container").one(".change-album-sorting");h&&this.registerEventHandler(h.on("click",this.handleChangeAlbumSorting.bind(this)))}e.on("albumToolbarView:layoutChange",(function(a){r&&(r.setValues({albumViewLayoutPref:a}),r.remoteUpdate()),"justified"===a?(n.addClass("justified-transitions"),n.addClass("justified"),s.setStyle("height",300),l&&e.flutil.onTransitionEnd(l,(function(){n.one(".album-attribution").addClass("justified-album-details-page")}))):(t=i.getAlbumHeaderHeight()-60+"px",s.setStyle("height",t),n.removeClass("justified"),l&&setTimeout((function(){n.one(".album-attribution").removeClass("justified-album-details-page")}),250),e.flutil.onTransitionEnd(s,(function(){n.removeClass("justified-transitions")})))}))},onSubviewEvent:function(e,t){var i=this.get("container"),a=i.one(".album-header-content"),n=i.one(".edit-cover-photo");return"album-title-desc-view"===e&&"albumTitleDesc:editing"===t[0]?(this.fire("parentViewEvent","albumHeaderView:editing"),n.addClass("hidden"),!1):"album-title-desc-view"===e&&"albumTitleDesc:doneEditing"===t[0]?(this.fire("parentViewEvent","albumHeaderView:doneEditing"),n.removeClass("hidden"),!1):void("album-title-desc-view"===e&&"albumTitleDescEditing:heightChange"===t[0]&&t[1]&&a.setStyle("height",parseInt(a.getComputedStyle("height"),10)+t[1]+"px"))},resizeHeader:function(e){var t=this.getAlbumHeaderHeight()-60;this.get("container").hasClass("justified")||this.albumHeaderElement.setStyle("height",t)},getAlbumHeaderHeight:function(){var e,t=this.appContext.viewportData.getWidth(),i=this.appContext.viewportData.getHeight()-50,a=120,n=t/2.3+a,o=t/2.75;return e=i>t/1.3+a?t/1.3:i>n?i-a:i>o?i-a+a*(i-n)/(o-n):i,Math.max(480,Math.round(e))},handleChangeAlbumSorting:function(t){if(this.appContext.flipper.isFlipped("enable-change-album-sorting")){t.halt();var i=this;this.get("albumModel").getValue("totalCount")>500?new e.Views.FluidModal({appContext:this.appContext,subview:new e.Views["confirmation-dialog-view"]({appContext:this.appContext,title:i.intlMessage({intlName:"common.OOPS"}),htmlMessage:"Sorting is limited to 500 photos.",showCancelButton:!1}),hasSubviewConfigRefactor:!0}).show():(this.sortingOptionsDialog=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,anchorElement:t.target,minVerticalSpace:250,positionFixed:!0,menuItems:[{text:this.intlMessage({intlName:"album-page.SORT_DATE_TAKEN_OLDEST"}),value:"date-posted-asc"},{text:this.intlMessage({intlName:"album-page.SORT_DATE_TAKEN_NEWEST"}),value:"date-posted-desc"},{text:this.intlMessage({intlName:"album-page.SORT_DATE_UPLOADED_OLDEST"}),value:"date-taken-asc"},{text:this.intlMessage({intlName:"album-page.SORT_DATE_UPLOADED_NEWEST"}),value:"date-taken-desc"},{text:this.intlMessage({intlName:"album-page.SORT_ALPHABETICALLY"}),value:"title"},{text:this.intlMessage({intlName:"album-page.SORT_RANDOMLY"}),value:"random"},{text:this.intlMessage({intlName:"album-page.SORT_REVERSE"}),value:"reverse"}]}),this.registerEventHandler(this.sortingOptionsDialog.on("selected",(function(t){if(t.preventDefault(),i.sortingOptionsDialog.close(),t.menuItem&&t.menuItem.value){var a={photoset_id:i.get("albumModel").getValue("id"),sort:t.menuItem.value,preview:0};new e.Views.FluidModal({appContext:this.appContext,subview:new e.Views["confirmation-dialog-view"]({appContext:this.appContext,title:i.intlMessage({intlName:"common.LOADING"}),htmlMessage:i.intlMessage({intlName:"album-page.SORT_ALMOST_DONE"}),showConfirmButton:!1,showCancelButton:!1,showCloseXButton:!1}),hasSubviewConfigRefactor:!0}).show(),i.appContext.callAPI("flickr.photosets.sortPhotos",a).then(i.onAlbumSortingChanged.bind(i)).catch(i.onAlbumSortingFailed.bind(i))}}))),this.sortingOptionsDialog.show())}},onAlbumSortingChanged:function(t){"ok"===t.stat?e.config.win.location.reload():this.onAlbumSortingFailed(t)},onAlbumSortingFailed:function(t){if("fail"===t.stat){new e.Views.FluidModal({appContext:this.appContext,subview:new e.Views["confirmation-dialog-view"]({appContext:this.appContext,title:this.intlMessage({intlName:"common.OOPS"}),htmlMessage:"Error while changing sort.",showCancelButton:!1}),hasSubviewConfigRefactor:!0}).show()}},handleSetCoverPhotoClick:function(t){t.preventDefault();var i,a,n=this.get("container"),o=this,s=this.get("albumModel"),l=this.templates("flickr-balls")({}),r=n.one(".edit-cover-photo"),h=this.appContext.viewportData.getDevicePixelRatio(),u=[{id:"photostream",name:this.intlMessage({intlName:"common.PHOTOSTREAM"}),value:"photostream"},{id:"sets",name:this.intlMessage({intlName:"common.ALBUMS"}),value:"sets",selected:!0},{id:"upload",name:this.intlMessage({intlName:"global-nav.UPLOAD"}),value:"upload"}],d=[{id:"photostream",name:this.intlMessage({intlName:"common.PHOTOSTREAM"}),value:"photostream"},{id:"sets",name:this.intlMessage({intlName:"common.ALBUMS"}),value:"sets",selected:!0}];let m=new e.Views["photo-selector-view"]({appContext:this.appContext,searchable:{yours:!0,contacts:!1,everyone:!1,marketplace:!1},defaultSelected:{id:o.albumId,title:o.get("albumModel").getValue("title"),type:"set"},navBarConfig:{links:[{id:"photostream",name:this.intlMessage({intlName:"common.PHOTOSTREAM"}),value:"photostream"},{id:"sets",name:this.intlMessage({intlName:"common.ALBUMS"}),value:"sets",selected:!0},{id:"upload",name:this.intlMessage({intlName:"global-nav.UPLOAD"}),value:"upload"}],enableSearch:!0,breakpointConfig:[{maxWidth:700,links:u,enableSearch:!1},{maxWidth:500,links:d,enableSearch:!1}],onClose:e=>{i.close()}},initialButtonState:{confirm:"disabled"},onConfirm:t=>{!(function(t){i.close(),r.replace(l);var u=m.get("selected");this.appContext.getModel("photo-models",u).then((function(e){return(!1===s.hasPhoto(u)?s.registry.remote.addPhoto({setID:o.albumId,photoID:u},o.appContext).then((function(){return o.fire("subviewViewEvent","newPhotoAddedToAlbum",u),s.registry.remote.setPrimaryPhoto({photoId:u,albumId:o.albumId},o.appContext)})):s.registry.remote.setPrimaryPhoto({photoId:u,albumId:o.albumId},o.appContext)).then((function(){a=e.getSizeToFit({width:.8*o.appContext.viewportData.getWidth()*h,height:(o.getAlbumHeaderHeight()-60)*h}),s.setValue("primary",e.id),s.setValue("primaryPhotoSizes",e.getValue("sizesForAlbum")),s.setValue("primaryNeedsInterstitial",e.getValue("needsInterstitial")),a&&n.one(".album-header-content").setStyle("background-image","url("+a.url+")"),n.one(".balls").replace(r)}))})).then(null,(function(t){new e.Views.FluidModal({appContext:this.appContext,subview:new e.Views["confirmation-dialog-view"]({appContext:this.appContext,title:o.intlMessage({intlName:"common.OOPS"}),htmlMessage:o.intlMessage({intlName:"album-page.ERROR_COVER_PHOTO"}),showCancelButton:!1}),hasSubviewConfigRefactor:!0}).show(),n.one(".balls").replace(r)}))})()}});(i=new e.Views.FluidModal({appContext:o.appContext,dismissOnOverlayClick:!0,showCancelButton:!1,actionButtonLabel:this.intlMessage({intlName:"common.SELECT"}),actionButtonDisabled:!0,subview:m,width:752,height:632,fullWindow:!0,hasSubviewConfigRefactor:!0,flexLayout:!0,classList:"photo-selector"})).registerEventHandler(e.on("photoSelector:selected",(function(e){m.confirmView.setButtonState({confirm:""})}))),i.registerEventHandler(e.on("photoSelector:unselected",(function(e){m.confirmView.setButtonState({confirm:"disabled"})}))),i.show()}})}),"@VERSION@",{requires:["flickr-view","hermes-template-album-header","hermes-template-flickr-balls"],optionalRequires:["hermes-core"],optional:["album-title-desc-view","album-stats-view","album-engagement-view","photo-selector-view","photo-list-photo-interaction-view","attribution-view"],langBundles:["album-page","global-nav","common"]});YUI.add("hermes-template-curation-edit-view",(function(t,e){var n=t.Template.Handlebars.revive({1:function(t,e,n,l,a){return"has-collage"},3:function(t,e,n,l,a){return"\t\t\t\t<div></div>\n\t\t\t\t<div></div>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,l,a){var i,o,c=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,r=t.escapeExpression,u="function",m=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return r((m(n,"outlet")||e&&m(e,"outlet")||s).call(c,null!=e?m(e,"basic-closeable-header-view"):e,{name:"outlet",hash:{},data:a,loc:{start:{line:1,column:0},end:{line:1,column:38}}}))+'\n<div class="curation-edit-container main">\n\t<div class="curation-edit-item curation-edit-title-item">\n\t\t<label for="curation-title-input">'+r((m(n,"intlMessage")||e&&m(e,"intlMessage")||s).call(c,{name:"intlMessage",hash:{intlName:"common.TITLE"},data:a,loc:{start:{line:4,column:36},end:{line:4,column:75}}}))+'</label>\n\t\t<input type="text" id="curation-title-input" class="input-field curation-title-input" placeholder="'+r((m(n,"intlMessage")||e&&m(e,"intlMessage")||s).call(c,{name:"intlMessage",hash:{intlName:"common.ADD_A_TITLE"},data:a,loc:{start:{line:5,column:101},end:{line:5,column:146}}}))+'" value="'+r(typeof(o=null!=(o=m(n,"title")||(null!=e?m(e,"title"):e))?o:s)===u?o.call(c,{name:"title",hash:{},data:a,loc:{start:{line:5,column:155},end:{line:5,column:164}}}):o)+'"/>\n\t</div>\n\t<div class="curation-edit-item curation-edit-description-item">\n\t\t<label for="curation-description-input">'+r((m(n,"intlMessage")||e&&m(e,"intlMessage")||s).call(c,{name:"intlMessage",hash:{intlName:"common.DESCRIPTION"},data:a,loc:{start:{line:8,column:42},end:{line:8,column:87}}}))+'</label>\n\t\t<textarea id="curation-description-input" class="input-field curation-description-input" placeholder="'+r((m(n,"intlMessage")||e&&m(e,"intlMessage")||s).call(c,{name:"intlMessage",hash:{intlName:"common.ADD_A_DESCRIPTION"},data:a,loc:{start:{line:9,column:104},end:{line:9,column:155}}}))+'" >'+r(typeof(o=null!=(o=m(n,"description")||(null!=e?m(e,"description"):e))?o:s)===u?o.call(c,{name:"description",hash:{},data:a,loc:{start:{line:9,column:158},end:{line:9,column:173}}}):o)+'</textarea>\n\t</div>\n\t<div class="curation-edit-item curation-edit-coverphoto-item">\n\t\t<label>'+r((m(n,"intlMessage")||e&&m(e,"intlMessage")||s).call(c,{name:"intlMessage",hash:{intlName:"common.COVER_PHOTO"},data:a,loc:{start:{line:12,column:9},end:{line:12,column:54}}}))+'</label>\n\t\t<div class="icon '+(null!=(i=m(n,"if").call(c,null!=e?m(e,"hasCollage"):e,{name:"if",hash:{},fn:t.program(1,a,0),inverse:t.noop,data:a,loc:{start:{line:13,column:19},end:{line:13,column:55}}}))?i:"")+'">\n\t\t\t<div class="photo"></div>\n'+(null!=(i=m(n,"if").call(c,null!=e?m(e,"hasCollage"):e,{name:"if",hash:{},fn:t.program(3,a,0),inverse:t.noop,data:a,loc:{start:{line:15,column:3},end:{line:18,column:10}}}))?i:"")+'\t\t</div>\n\t\t<a role="button" class="cover-photo-button" tabindex="0">'+r(typeof(o=null!=(o=m(n,"coverPhotoText")||(null!=e?m(e,"coverPhotoText"):e))?o:s)===u?o.call(c,{name:"coverPhotoText",hash:{},data:a,loc:{start:{line:20,column:59},end:{line:20,column:77}}}):o)+"</a>\n\t</div>\n</div>\n"+r((m(n,"outlet")||e&&m(e,"outlet")||s).call(c,null!=e?m(e,"basic-confirm-actions-view"):e,{name:"outlet",hash:{},data:a,loc:{start:{line:23,column:0},end:{line:23,column:37}}}))+"\n"},useData:!0}),l={};t.Array.each([],(function(e){var n=t.Template.get("hermes/"+e);n&&(l[e]=n)})),t.Template.register("hermes/curation-edit-view",(function(e,a){return(a=a||{}).partials=a.partials?t.merge(l,a.partials):l,n(e,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});