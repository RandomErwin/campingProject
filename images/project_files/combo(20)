YUI.add("person-public-profile-models",(function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-profile-getProfile"].run(t,this.appContext)},updateField:function(t,r){return e.ModelUpdaters["flickr-profile-setProfile"].run(t,r)},updateFirstAndLastName:function(t,r){return e.ModelUpdaters["flickr-account-changeFirstAndLastName"].run(t,r)}},remoteUpdateDescription:function(e,t,r){return this.setValue(e,"description",t.description),this.remote.updateBioField(t,r)},attributes:{nsid:{readOnly:!0,defaultFn:function(e){return e}},joinedDate:{validator:function(t){return e.AttributeHelpers.validateDate(t)},setter:function(t){return e.AttributeHelpers.coerceDate(t)},serialize:function(e){return e.format("X")},deserialize:function(t){return e.moment(t,"X")}},showcaseSetId:{defaultValue:"0"},city:{},country:{},firstName:{},lastName:{},hometown:{},email:{},occupation:{},profileDescription:{},profileDescriptionExpanded:{},timezone:{},website:{},facebook:{},facebookUrl:{},instagram:{},instagramUrl:{},tumblr:{},tumblrUrl:{},twitter:{},twitterUrl:{},pinterest:{},pinterestUrl:{},totalViews:{},totalTags:{},totalGeotagged:{},totalFaves:{},totalInGroup:{}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-profile-getProfile-fetcher","flickr-profile-setProfile-updater","flickr-account-changeFirstAndLastName-updater","moment"]});YUI.add("flickr-account-changeUsername-updater",(function(e,n){"use strict";e.namespace("ModelUpdaters")["flickr-account-changeUsername"]={run:function(r,o){var s=(function(e){return{username:e.username}})(r);return new e.FlickrPromise({apiResponse:o.callAPI("flickr.account.changeUsername",s),personModel:o.getModel("person-models",r.id)}).then(function(e){return(function(e,n,r,o){var s=e.apiResponse,a=e.personModel;if(s)return s.newUsername&&void 0!==s.newUsername&&a.setValue("username",s.newUsername),s})(e)}.bind(this),e.FetcherErrorLogger(n))}}}),"@VERSION@",{requires:["flickr-promise"],optional:["person-public-profile-models"]});YUI.add("person-model-helper",(function(e){e.PersonModelHelper={attributes:{pathAlias:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)||void 0},defaultFn:function(e){return e}},username:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},realname:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},displayname:{readOnly:!0,derivedBy:["username","realname"],getter:function(e,t){return this.getValue(t,"realname")||this.getValue(t,"username")}},nsid:{readOnly:!0,defaultFn:function(e){return e}},url:{readOnly:!0,derivedBy:["pathAlias"],defaultFn:function(e){return"/photos/"+this.getValue(e,"pathAlias")+"/"}},isMe:{readOnly:!0,defaultFn:function(e){var t=this.appContext.getViewer();return t.signedIn&&t.nsid===e}}}}}),"@VERSION@",{requires:[]});YUI.add("person-models",(function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-people-getInfo"].run(t,this.appContext)},updateUsername:function(t,r){return e.ModelUpdaters["flickr-account-changeUsername"].run(t,r)}},attributes:{pathAlias:e.PersonModelHelper.attributes.pathAlias,username:e.PersonModelHelper.attributes.username,realname:e.PersonModelHelper.attributes.realname,displayname:e.PersonModelHelper.attributes.displayname,nsid:e.PersonModelHelper.attributes.nsid,url:e.PersonModelHelper.attributes.url,isMe:e.PersonModelHelper.attributes.isMe,buddyicon:{},isPro:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},proBadge:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},isMinor:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},proExpireDate:{validator:function(t){return e.AttributeHelpers.validateDate(t)},setter:function(t){return e.AttributeHelpers.coerceDate(t)},serialize:function(e){return e.format("X")},deserialize:function(t){return e.moment(t,"X")}},isDeleted:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},isAdFree:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},isNoAds:{derivedBy:["isPro","isAdFree"],readOnly:!0,getter:function(e,t){var r=this.getValue(t,"isPro"),n=this.getValue(t,"isAdFree");return r||n}},hasStats:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasAdfree:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},has1TB:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},has2TB:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasUnlimitedStorage:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasFreeStandardShipping:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasFreeEducationalResources:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},dateCreated:{validator:function(t){return e.AttributeHelpers.validateDate(t)},setter:function(t){return e.AttributeHelpers.coerceDate(t)},serialize:function(e){return e.format("X")},deserialize:function(t){return e.moment(t,"X")}},location:{defaultFn:function(){return""}},expiringPartner:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultFn:function(){return!1}},uploadCount:{defaultValue:null},uploadLimit:{defaultValue:null},uploadLimitStatus:{defaultValue:null},isCognitoUser:{defaultValue:null},hasAuthorizedMobile:{defaultValue:null},hasInvalidEmail:{defaultValue:!1},subscription:{defaultValue:{isPastDue:!1,isPro:!1,isClosed:!1}},contactsCacheUrl:{defaultValue:!1},segments:{defaultValue:[]},isEligibleForGifts:{defaultValue:!1},eligibleGifts:{defaultValue:[]},newFlow:{defaultValue:!1},marketingPrefsLink:{defaultValue:"",validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-people-getInfo-fetcher","flickr-account-changeUsername-updater","attribute-helpers","person-model-helper","moment"]});YUI.add("flickr-people-getInfo-fetcher",(function(e,s){"use strict";var r=new e.SubscriptionsHelper,o=require("hermes-core/flog")(s);e.namespace("ModelFetchers")["flickr-people-getInfo"]={run:function(r,o){var i=this,t=o.getViewer();return t&&t.signedIn&&(r.id===t.nsid||r.nsid===t.nsid)&&(r.storage=1),new e.FlickrPromise({apiResponse:o.callAPI("flickr.people.getInfo",this._processParams(r,o),!0),personModelRegistry:o.getModelRegistry("person-models"),personRelationshipModelRegistry:o.getModelRegistry("person-relationship-models"),personProfileModelRegistry:o.getModelRegistry("person-profile-models"),personPreferencesModelRegistry:o.getModelRegistry("person-preferences-models"),personGroupsModelRegistry:o.getModelRegistry("person-groups-models"),personNotificationsModelRegistry:o.getModelRegistry("person-notifications-models"),photostreamModelRegistry:o.getModelRegistry("photostream-models"),privilegesModelRegistry:o.getModelRegistry("privileges-models")}).then((function(e){return i._processResponse(e,r,o)}),e.FetcherErrorLogger(s))},_processParams:function(s,r){var o={datecreate:1,extras:e.APIHelper.request.getRebootPeopleExtras()};if(YUI.Env.isServer&&s.id===r.request.probableUser?(o.storage=1,o.extras+=","+["classic_user_id","timezone_dst","unified_search_view_pref","photostream_view_order_pref","photostream_view_as_pref","album_view_layout","download_pref","products_features","subscriptions","is_minor","privileges"].join(",")):r.getViewer().signedIn&&s.id===r.getViewer().nsid&&(o.extras+=","+["products_features","subscriptions"].join(",")),s.extras&&"string"==typeof s.extras&&s.extras.length>0&&(o.extras+=","+s.extras),s.id)o.user_id=s.id;else{if(!s.pathAlias)throw new Error("`fetch` is missing required params.");o.path_alias=s.pathAlias}return s.storage&&(o.storage=s.storage),o.extras||(o.extras=""),o.extras+=", has_stats",o},_processResponse:function(s,i,t){var a,n,l,p=s.apiResponse,d=s.personModelRegistry,g=s.personRelationshipModelRegistry,u=s.personProfileModelRegistry,m=s.personPreferencesModelRegistry,c=s.personGroupsModelRegistry,h=s.personNotificationsModelRegistry,f=s.photostreamModelRegistry,v=s.privilegesModelRegistry,y=p.person,M=t.getViewer(),R=y.id,P=M&&M.signedIn&&R===M.nsid;return l={id:R,pathAlias:y.pathAlias,username:y.username&&y.username._content,realname:y.realname&&y.realname._content,buddyicon:e.APIHelper.response.removeProtocolFromURL(y.iconurls),isAdFree:y.isAdFree,isPro:y.ispro,proBadge:y.proBadge,isMinor:y.isMinor,hasStats:y.hasStats,location:y.location&&y.location._content,hasAdfree:y.hasAdfree,has1TB:y.has1TB,has2TB:y.has2TB,hasUnlimitedStorage:y.hasUnlimitedStorage,hasFreeStandardShipping:y.hasFreeStandardShipping,hasFreeEducationalResources:y.hasFreeEducationalResources,dateCreated:y.datecreate._content,expiringPartner:y.expiringPartner},y.ispro&&(l.proExpireDate=y.expire),y.gift&&(l.isEligibleForGifts=y.gift.giftEligible||!1,l.eligibleGifts=y.gift.eligibleDurations||[],l.newFlow=y.gift.newFlow||!1),P&&(y.uploadLimits?(l.uploadLimit=y.uploadLimits.uploadLimit,l.uploadCount=y.uploadLimits.uploadCount):(l.uploadLimit=y.uploadLimit,l.uploadCount=y.uploadCount),l.uploadLimitStatus=y.uploadLimitStatus,l.isCognitoUser=y.isCognitoUser,l.hasInvalidEmail=!1,y.email&&(!y.email||y.email._content&&""!==y.email._content)?y.email._content&&-1===y.email._content.indexOf("@")?l.hasInvalidEmail=!0:l.hasInvalidEmail=!1:l.hasInvalidEmail=!0,l.isPro&&(l.subscription=r.parseEffectiveSubscriptionData(!0,p.effectiveSubscriptions)),y.contactsCacheUrl&&(l.contactsCacheUrl=y.contactsCacheUrl),y.segments&&y.segments.length?(l.segments=y.segments,o.info("User belongs to these segments",l.segments)):o.info("User is not in any segment"),y.email&&y.email.prefsLink&&(l.marketingPrefsLink=y.email.prefsLink)),d.addOrUpdate(l),h.addOrUpdate({id:R,unreadFlickrMailCount:y.unreadMessages?y.unreadMessages.content:0}),g.addOrUpdate({id:R,pathAlias:y.pathAlias,isContact:y.contact,isFriend:y.friend,isFamily:y.family,isIgnored:y.ignored,isIgnoredBy:y.ignoredby,isRevContact:y.revcontact,isRevFriend:y.revfriend,isRevFamily:y.revfamily}),P&&(n={id:R},y.safeSearch&&(n.safeSearch=(y.safeSearch||1)-1),y.viewPrefs&&(n.unifiedSearchViewPref=y.viewPrefs.unifiedSearchViewPref,n.photostreamViewOrderPref=y.viewPrefs.photostreamViewOrderPref,n.photostreamViewAsPref=y.viewPrefs.photostreamViewAsPref,n.albumViewLayoutPref=y.viewPrefs.albumViewLayout,n.galleryViewLayoutPref=y.viewPrefs.galleriesViewLayoutPref,n.photostreamViewLayoutPref=y.viewPrefs.photostreamLayoutType),m.exists(R)?m.setValues(R,n):m.add(n),y.privileges&&v.addOrUpdate({id:R,privileges:y.privileges,uploadLimits:y.uploadLimits})),a={id:R,coverPhotoUrls:e.APIHelper.response.removeProtocolFromURL(y.coverphoto_url),photoCount:y.photos.count.content,location:y.location?y.location.content:null,arrPhotoCount:y.all_rights_reserved_photos_count},y.storage&&(a.storageUsed=y.storage.used.content,a.storageTotal=y.storage.total.content),y.unreadMessages&&(a.unreadMessages=y.unreadMessages.content),u.addOrUpdate(a),c.addOrUpdate({id:R,memberCount:y.groupMemberships?y.groupMemberships.member:null,moderatorCount:y.groupMemberships?y.groupMemberships.moderator:null,adminCount:y.groupMemberships?y.groupMemberships.admin:null,invitedCount:y.groupMemberships?y.groupMemberships.invited:null}),f.addOrUpdate({id:R,pathAlias:y.pathAlias,owner:d.proxy(R),totalItems:y.photos.count&&y.photos.count.content}),y}}}),"@VERSION@",{requires:["flickr-promise","subscriptions-helper"],optionalRequires:["hermes-core"],optional:["person-models","person-relationship-models","person-preferences-models","person-profile-models","person-groups-models","photostream-models","person-notifications-models","privileges-models","api-helper"]});YUI.add("person-relationship-models",(function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-people-getInfo"].run(t,this.appContext)},update:function(t,i){var r=[],n={};return e.Lang.isObject(i,!0)&&(n.user_id=t,n.friend=this.getValue(t,"isFriend"),n.family=this.getValue(t,"isFamily"),"isContact"in i&&(i.isContact.newVal?r.push(e.ModelUpdaters["flickr-contacts-add"].run(n,this.appContext)):r.push(e.ModelUpdaters["flickr-contacts-remove"].run(n,this.appContext))),("isFriend"in i||"isFamily"in i)&&("isFriend"in i&&(n.friend=i.isFriend.newVal),"isFamily"in i&&(n.family=i.isFamily.newVal),r.push(e.ModelUpdaters["flickr-contacts-edit"].run(n,this.appContext))),"isIgnored"in i&&(!0===i.isIgnored.newVal?r.push(e.ModelUpdaters["flickr-contacts-block"].run(n,this.appContext)):r.push(e.ModelUpdaters["flickr-contacts-unblock"].run(n,this.appContext)))),e.Promise.all(r)}},toggleFollowing:function(e){this.getValue(e,"isContact")?this.setValue(e,"isContact",!1):this.setValue(e,"isContact",!0)},toggleFriend:function(e){this.getValue(e,"isFriend")?this.setValue(e,"isFriend",!1):this.setValue(e,"isFriend",!0)},toggleFamily:function(e){this.getValue(e,"isFamily")?this.setValue(e,"isFamily",!1):this.setValue(e,"isFamily",!0)},toggleIgnore:function(e){this.getValue(e,"isIgnored")?this.setValue(e,"isIgnored",!1):this.setValue(e,"isIgnored",!0)},attributes:{pathAlias:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},isContact:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isFriend:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isFamily:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isRevContact:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isRevFriend:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isRevFamily:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isIgnoredBy:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isIgnored:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isMe:{readOnly:!0,getter:function(e,t){var i=this.appContext.getViewer();return!!i&&this.getValue(t,"nsid")===i.nsid}},nsid:{readOnly:!0,defaultFn:function(e){return e}}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-people-getInfo-fetcher","flickr-contacts-add-updater","flickr-contacts-remove-updater","flickr-contacts-edit-updater","flickr-contacts-block-updater","flickr-contacts-unblock-updater","attribute-helpers"]});YUI.add("math-helper",(function(e){e.MathHelper=function(e){return{seedRandom:function(e){return 0+1*((e=(9301*e+49297)%233280)/233280)}}}}),"@VERSION@",{requires:[]});YUI.add("banner-helper",(function(e,n){var i=require("hermes-core/flog")(n),r=e.mix({langBundles:this.details.langBundles},e.Localizable),o=new e.SubscriptionsHelper;e.BannerHelper=function(n){var t=this,a=[],s=[],l={tempServerless:function(e){return{priority:"priority"in e?e.priority:Number.MAX_VALUE,placement:"placement"in e?e.placement:"header",load:function(){return Promise.resolve()},canShowBanner:function(){let e=n.getCookie("force_serverless");return"1"===e||"2"===e},viewName:"serverless-api-banner-view",viewConfig:{}}},loginMigration:function(e){return{priority:"priority"in e?e.priority:Number.MAX_VALUE,placement:"placement"in e?e.placement:"header",load:function(){return Promise.resolve()},canShowBanner:function(){var e=!1,i=n.getViewer().isCognitoUser;return n.getViewer().signedIn&&!i&&-1===["products-pro-view","pro-checkout-view","sohp-slideshow-sohp-e-view","download-page-view","chrome-page-view"].indexOf(n.flapp.get("activeView").name)&&(e=!0),e},viewName:"login-migration-banner-view",viewConfig:{}}},pastDue:function(e){var i;function r(){return-1===["pro-checkout-view","sohp-slideshow-sohp-e-view","account-settings-view"].indexOf(n.flapp.get("activeView").name)}return{priority:"priority"in e?e.priority:Number.MAX_VALUE,placement:"placement"in e?e.placement:"header",load:function(){var e=n.getViewer();return e.signedIn&&e.isPro?n.getModel("person-models",e.nsid).then((function(e){var n=e.getValue("subscription");i=n.isPastDue})):(i=!1,Promise.resolve())},canShowBanner:function(){var e=!1;return n.getViewer().signedIn&&n.getViewer().isPro&&r()&&i&&(e=!0),e&&r()},viewName:"past-due-banner-view",viewConfig:{}}},migrateSubscription:function(i){var r="priority"in i?i.priority:Number.MAX_VALUE,t="placement"in i?i.placement:"header",a=!1,s=!1;return{priority:r,placement:t,load:function(){var i=n.getViewer();return i.signedIn&&i.isPro?n.getModel("effective-subscriptions-models",i.nsid).then(function(i){if(i&&i.getValue("length")>0){var r=o.getEligibleSubscription(i,!0);r&&(a=r.isBraintreeSubscription||r.isDigitalRiverSubscription&&n.flipper.isFlipped("enable-dr-paypal-migrate-banner"),s=r.nextBillingDate&&r.nextBillingDate.isBefore&&r.nextBillingDate.isBefore(e.moment().add(15,"days")))}}.bind(this)):(a=!1,Promise.resolve())},canShowBanner:function(){var i=!1;return n.getViewer().signedIn&&n.getViewer().isPro&&a&&-1===["products-pro-view","pro-checkout-view","sohp-slideshow-sohp-e-view","download-page-view","chrome-page-view"].indexOf(n.flapp.get("activeView").name)&&(!n.getCookie(e.config.flickr.banners.dismiss_braintree_migration_banner_name)||n.getCookie(e.config.flickr.banners.dismiss_braintree_migration_banner_name)&&s)&&(i=!0),i},viewName:"subscription-migrate-banner-view",viewConfig:{}}},cookie:function(i){return{priority:"priority"in i?i.priority:Number.MAX_VALUE,placement:"placement"in i?i.placement:"footer",load:function(){return Promise.resolve()},canShowBanner:function(){return!n.getCookie(e.config.flickr.banners.dismiss_cookie_banner_name)&&!n.requiresCookieConsent},viewName:"cookie-banner-view",viewConfig:{}}},cookieConsent:function(e){var i,r="priority"in e?e.priority:Number.MAX_VALUE,o="placement"in e?e.placement:"footer";return{priority:r,placement:o,load:function(){return n.trustarcConsentManager?new Promise(((e,r)=>{i=setTimeout(e,1e4),n.trustarcConsentManager.onReady((()=>{clearTimeout(i),e()}))})):Promise.resolve()},canShowBanner:function(){var e=n.flipper.isFlipped("enable-cookie-consent-execution-hermes")&&n.requiresCookieConsent&&"truste"in window&&"PrivacyManagerAPI"in window;if(e){var i=window.truste.cma.callApi("getConsentDecision","flickr.com");i&&(e=0===i.consentDecision)}return e},viewName:"trustarc-consent-banner-view",viewConfig:{}}},uploadLimit:function(i){var r;return{priority:"priority"in i?i.priority:Number.MAX_VALUE,placement:"placement"in i?i.placement:"header",load:function(){return n.getViewer().signedIn?n.getModel("person-profile-models",n.getViewer().nsid).then((function(e){r=e})):Promise.resolve()},canShowBanner:function(){var i=!n.getCookie(e.config.flickr.upload_blocking.dismiss_over_upload_limit_message_cookie_name)&&e.UserLimitsHelper.isOverARRLimit(r,n)&&"products-flickrpro-route"!==n.routeConfig.module,o=!n.getCookie(e.config.flickr.upload_blocking.dismiss_at_upload_limit_message_cookie_name)&&e.UserLimitsHelper.isAtUploadLimit(r,n),t=!n.getCookie(e.config.flickr.upload_blocking.dismiss_near_upload_limit_message_cookie_name)&&e.UserLimitsHelper.isNearUploadLimit(r,n);return n.flipper.isFlipped("enable-upload-limit-messages")&&n.getViewer().signedIn&&-1===["products-pro-view","pro-checkout-view","sohp-slideshow-sohp-e-view","download-page-view","chrome-page-view"].indexOf(n.flapp.get("activeView").name)&&(i||o||t)},viewName:"upload-limit-banner-view",viewConfig:{}}},surveyModal:function(i){var r="priority"in i?i.priority:Number.MAX_VALUE,o="placement"in i?i.placement:"header";let t,a=new e.MathHelper,s="",l=(e.config.flickr.geo,n.lang?n.lang.substr(0,2):""),c=!1;return l&&["en","es","fr","de","it","zh"].indexOf(l)>-1&&(c=!0,s="HJ7TGFZ"),{priority:r,placement:o,load:function(){let e=n.getViewer();return e.signedIn?n.getModel("person-models",e.nsid).then((function(e){t=e,t.getValue("isPro")||(c=!1)})):Promise.resolve()},canShowBanner:function(){let i=!1,r=t?t.getValue("nsid"):void 0,o=new URLSearchParams(window.location.search);if(n.flipper.isFlipped("enable-feedback-modal")){var l=!0,p=r?parseInt(r.substring(0,r.indexOf("@"))):(u=1e8,m=999999999,Math.floor(Math.random()*(m-u)+u));p&&(l=n.viewportData.getWidth()>700?a.seedRandom(p)<.03:a.seedRandom(p)<.2),!YUI.Env.isServer&&l&&n.getViewer().signedIn&&-1===["products-pro-view","pro-checkout-view","sohp-slideshow-sohp-e-view","download-page-view","chrome-page-view"].indexOf(n.flapp.get("activeView").name)&&"photostream-route"!==n.routeConfig.module&&!window.localStorage.getItem(e.config.flickr.banners.dismiss_survey_modal_name)&&window.URLSearchParams&&c&&(i=!0)}var u,m;return!n.flipper.isFlipped("enable-force-feedback-modal")||YUI.Env.isServer||window.localStorage.getItem(e.config.flickr.banners.dismiss_survey_modal_name)||(i=!0),n.flipper.isFlipped("enable-feedback-modal")&&o.has("survey")&&(i=!0),i&&s},viewName:"feedback-prompt-view",viewConfig:{surveyKey:s}}},defaultSafetyMigration:function(e){var i,t,a="priority"in e?e.priority:Number.MAX_VALUE,s="placement"in e?e.placement:"header",l=n.getViewer(),c=o.getProLandingPageUrl(o.UTM_SAFETY_UPSELL,{source:n.flapp.get("activeView").isMobile?"mobile":"desktop",medium:"defaultSafetyChangeModal"});return{priority:a,placement:s,load:function(){return l.signedIn?Promise.all([n.getModel("privileges-models",l.nsid),n.getModel("account-settings-models",l.nsid,{user_id:l.nsid})]).then((e=>{i=e[0],t=e[1]})).catch((e=>{console.log(e)})):Promise.resolve()},canShowBanner:function(){let e=!1;return YUI.Env.isServer||!l.signedIn||-1!==["products-pro-view","pro-checkout-view","sohp-slideshow-sohp-e-view","download-page-view","chrome-page-view"].indexOf(n.flapp.get("activeView").name)||"safe"===t.getValue("permissions").defaultUploads.defaultSafetyLevel||i.getValue("privileges").canSetNonSafe||(e=!0),e},viewName:"confirmation-dialog-view",viewConfig:{appContext:n,title:r.intlMessage({intlName:"banners.DEFAULT_SAFETY_CHANGE_MODAL_TITLE"}),htmlMessage:r.intlMessage({intlName:"banners.DEFAULT_SAFETY_CHANGE_MODAL_BODY"})+"<br>"+r.intlHTMLMessage({intlName:"banners.DEFAULT_SAFETY_CHANGE_MODAL_MORE_INFO",blogPostURL:"https://www.flickrhelp.com/hc/en-us/articles/13690320471060-Free-account-limit-changes-and-enforcement"}),confirmButtonText:r.intlMessage({intlName:"banners.DEFAULT_SAFETY_CHANGE_MODAL_UPGRADE"}),cancelButtonText:r.intlMessage({intlName:"banners.DEFAULT_SAFETY_CHANGE_MODAL_CHANGE"}),showCloseXButton:!1,onConfirm:async(e,i)=>{i.setLoading({confirm:"loading"}),n.flapp.navigate(c)},onCancel:async(e,i)=>{i.setLoading({cancel:"loading"}),n.callAPI("flickr.prefs.setSafetyLevel",{safety_level:1}).then((function(e){var n;if("ok"!==e.stat)throw e;(n=t.getValue("permissions")).defaultUploads.defaultSafetyLevel="safe",t.setValue("permissions",n),i.fire("dismiss")}),(function(e){console.log(e)}))}},containerConfig:{dismissOnOverlayClick:!1,hasSubviewConfigRefactor:!0}}},exploredUpsell:function(i){var r="priority"in i?i.priority:Number.MAX_VALUE,o="placement"in i?i.placement:"header",t=n.getViewer(),a=!1;return{priority:r,placement:o,load:function(){return t.isPro||n.segments.hasSegment("explored_non_pro_users")&&(a=!0),Promise.resolve()},canShowBanner:function(){return!t.isPro&&a&&-1===["products-pro-view","pro-checkout-view","sohp-slideshow-sohp-e-view","download-page-view","chrome-page-view"].indexOf(n.flapp.get("activeView").name)&&!n.getCookie(e.config.flickr.banners.dismiss_explored_upsell_banner_name)},viewName:"explored-upsell-banner-view",viewConfig:{}}},churnedProBanner:function(i){var r="priority"in i?i.priority:Number.MAX_VALUE,o="placement"in i?i.placement:"header",t=n.getViewer(),a=!1;return{priority:r,placement:o,load:function(){return t.isPro||n.segments.hasSegment("pro_churned_user_1_month")&&(a=!0),Promise.resolve()},canShowBanner:function(){return a&&-1===["products-pro-view","pro-checkout-view","sohp-slideshow-sohp-e-view","download-page-view","chrome-page-view"].indexOf(n.flapp.get("activeView").name)&&!n.getCookie(e.config.flickr.banners.dismiss_churned_pro_banner_name)},viewName:"churned-pro-banner-view",viewConfig:{}}},bhmExploreBanner:function(i){return{priority:"priority"in i?i.priority:Number.MAX_VALUE,placement:"placement"in i?i.placement:"header",load:function(){return Promise.resolve()},canShowBanner:function(){return!n.getCookie(e.config.flickr.banners.dismiss_bhm_explore_banner_name)&&"explore-page-view"===n.flapp.get("activeView").name},viewName:"bhm-explore-banner-view",viewConfig:{},startTime:new Date("2024-02-29T05:00:00.000Z"),endTime:new Date("2024-03-01T04:55:00.000Z")}}};function c(){s=a.sort((function(e,n){return e.priority-n.priority}))}function p(e){var n,i,r=s.find((function(n,i){var r=void 0===e||n.placement===e,o=new Date,t=o<n.startTime||o>n.endTime;if(r&&!t&&n.canShowBanner())return!0}));if(r)return n=a.indexOf(r),-1!==(i=n)&&(a.splice(i,1),c()),r}return this.loadBanners=function(e){var n;return a=[],s=[],n=e.map((function(e){return(function(e){var n=new l[e.type]({priority:e.priority,placement:e.placement});return n?n.load().then((function(){!(function(e){a.push(e),c()})(n)})).catch((function(e){i.error("Failed to load and register banner.",{err:e})})):Promise.resolve()})(e)})),Promise.all(n)},this.getBanners=function(e){var n=[];return e.forEach((function(e){var i=p(e);i&&n.push(i)})),n},this.getQueue=function(){return s},this.typeObjects=l,this.renderBannerView=function(e){return(function(e){return n.getView(e.viewName,e.viewConfig).then((function(e){var i;return n.getView("banner-view",{subview:e}).then((function(e){return(i=e).initialize()})).then((function(){return i}))}),(function(e){i.warn("Error loading banner view",{err:e})}))})(e).then((function(n){t.fire("renderBanner",{placement:e.placement,bannerView:n,containerConfig:e.containerConfig})}))},this},e.augment(e.BannerHelper,e.EventTarget)}),"@VERSION@",{requires:["banner-view","event-custom","effective-subscriptions-models","person-models","subscriptions-helper","math-helper","moment"],optionalRequires:["hermes-core"],langBundles:["banners"]});