YUI.add("hermes-template-like-engagement-item",(function(n,e){var l=n.Template.Handlebars.revive({1:function(n,e,l,t,a){return" liked"},3:function(n,e,l,t,a){return" can-not-like"},5:function(n,e,l,t,a){return" padded"},7:function(n,e,l,t,a){return" small"},9:function(n,e,l,t,a){return" theme-light"},11:function(n,e,l,t,a){return" theme-dark"},13:function(n,e,l,t,a){return" empty"},15:function(n,e,l,t,a){return" hidden"},17:function(n,e,l,t,a){var o,i=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return n.escapeExpression((i(l,"formatNumber")||e&&i(e,"formatNumber")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},null!=(o=null!=(o=null!=(o=null!=e?i(e,"engagement"):e)?i(o,"reactions"):o)?i(o,"like"):o)?i(o,"count"):o,{name:"formatNumber",hash:{},data:a,loc:{start:{line:23,column:41},end:{line:23,column:89}}}))},compiler:[8,">= 4.3.0"],main:function(n,e,l,t,a){var o,i=null!=e?e:n.nullContext||{},r=n.hooks.helperMissing,u=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'<span role="button"\n\tclass="like-engagement-item\n\t'+(null!=(o=u(l,"if").call(i,null!=(o=null!=(o=null!=(o=null!=e?u(e,"engagement"):e)?u(o,"reactions"):o)?u(o,"like"):o)?u(o,"didViewerReact"):o,{name:"if",hash:{},fn:n.program(1,a,0),inverse:n.noop,data:a,loc:{start:{line:8,column:1},end:{line:8,column:62}}}))?o:"")+"\n\t"+(null!=(o=u(l,"if").call(i,null!=(o=null!=(o=null!=(o=null!=e?u(e,"engagement"):e)?u(o,"reactions"):o)?u(o,"like"):o)?u(o,"canReact"):o,{name:"if",hash:{},fn:n.noop,inverse:n.program(3,a,0),data:a,loc:{start:{line:9,column:1},end:{line:9,column:63}}}))?o:"")+"\n\t"+(null!=(o=u(l,"if").call(i,null!=e?u(e,"isPadded"):e,{name:"if",hash:{},fn:n.program(5,a,0),inverse:n.noop,data:a,loc:{start:{line:10,column:1},end:{line:10,column:31}}}))?o:"")+"\n\t"+(null!=(o=(u(l,"ifCond")||e&&u(e,"ifCond")||r).call(i,null!=e?u(e,"size"):e,"===","small",{name:"ifCond",hash:{},fn:n.program(7,a,0),inverse:n.noop,data:a,loc:{start:{line:11,column:1},end:{line:11,column:48}}}))?o:"")+"\n\t"+(null!=(o=(u(l,"ifCond")||e&&u(e,"ifCond")||r).call(i,null!=e?u(e,"theme"):e,"===","light",{name:"ifCond",hash:{},fn:n.program(9,a,0),inverse:n.noop,data:a,loc:{start:{line:12,column:1},end:{line:12,column:55}}}))?o:"")+"\n\t"+(null!=(o=(u(l,"ifCond")||e&&u(e,"ifCond")||r).call(i,null!=e?u(e,"theme"):e,"===","dark",{name:"ifCond",hash:{},fn:n.program(11,a,0),inverse:n.noop,data:a,loc:{start:{line:13,column:1},end:{line:13,column:53}}}))?o:"")+'"\n\ttabindex="0">\n\n\t<span class="like-engagement-icon">\n\t\t<svg class="icon icon-like"><use xlink:href="#icon-like"></use></svg>\n\t\t<svg class="icon icon-liked"><use xlink:href="#icon-liked"></use></svg>\n\t</span>\n\t<span class="like-engagement-count\n\t\t'+(null!=(o=u(l,"if").call(i,null!=(o=null!=(o=null!=(o=null!=e?u(e,"engagement"):e)?u(o,"reactions"):o)?u(o,"like"):o)?u(o,"count"):o,{name:"if",hash:{},fn:n.noop,inverse:n.program(13,a,0),data:a,loc:{start:{line:21,column:2},end:{line:21,column:54}}}))?o:"")+"\n\t\t"+(null!=(o=u(l,"if").call(i,null!=e?u(e,"showCount"):e,{name:"if",hash:{},fn:n.noop,inverse:n.program(15,a,0),data:a,loc:{start:{line:22,column:2},end:{line:22,column:33}}}))?o:"")+'">\n\t\t'+(null!=(o=u(l,"if").call(i,null!=(o=null!=(o=null!=(o=null!=e?u(e,"engagement"):e)?u(o,"reactions"):o)?u(o,"like"):o)?u(o,"count"):o,{name:"if",hash:{},fn:n.program(17,a,0),inverse:n.noop,data:a,loc:{start:{line:23,column:2},end:{line:23,column:96}}}))?o:"")+"\n\t</span>\n</span>"},useData:!0}),t={};n.Array.each([],(function(e){var l=n.Template.get("hermes/"+e);l&&(t[e]=l)})),n.Template.register("hermes/like-engagement-item",(function(e,a){return(a=a||{}).partials=a.partials?n.merge(t,a.partials):t,l(e,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-first-like-modal",(function(e,a){var l=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,a,l,n,t){var s,r=null!=a?a:e.nullContext||{},i=e.hooks.helperMissing,o="function",m=e.escapeExpression,c=e.lookupProperty||function(e,a){if(Object.prototype.hasOwnProperty.call(e,a))return e[a]};return'<img src="'+m(typeof(s=null!=(s=c(l,"assetRoot")||(null!=a?c(a,"assetRoot"):a))?s:i)===o?s.call(r,{name:"assetRoot",hash:{},data:t,loc:{start:{line:1,column:10},end:{line:1,column:23}}}):s)+'/images/likes/get-ya-dang-thumbs-up.svg">\n\n<p><strong>'+m((c(l,"intlMessage")||a&&c(a,"intlMessage")||i).call(r,{name:"intlMessage",hash:{intlName:"likes.EXCITED_MODAL_HEADER"},data:t,loc:{start:{line:3,column:11},end:{line:3,column:64}}}))+"</strong></p>\n<span>"+m((c(l,"intlMessage")||a&&c(a,"intlMessage")||i).call(r,{name:"intlMessage",hash:{intlName:"likes.LIKES_MODAL_DESC"},data:t,loc:{start:{line:4,column:6},end:{line:4,column:55}}}))+'</span><br>\n<br>\n<a href="'+m(typeof(s=null!=(s=c(l,"url")||(null!=a?c(a,"url"):a))?s:i)===o?s.call(r,{name:"url",hash:{},data:t,loc:{start:{line:6,column:9},end:{line:6,column:16}}}):s)+'" target="_blank">'+m((c(l,"intlMessage")||a&&c(a,"intlMessage")||i).call(r,{name:"intlMessage",hash:{intlName:"common.LEARN_MORE"},data:t,loc:{start:{line:6,column:34},end:{line:6,column:78}}}))+"</a>\n"},useData:!0}),n={};e.Array.each([],(function(a){var l=e.Template.get("hermes/"+a);l&&(n[a]=l)})),e.Template.register("hermes/first-like-modal",(function(a,t){return(t=t||{}).partials=t.partials?e.merge(n,t.partials):n,l(a,t)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("likes-helper",(function(e,i){var n=require("hermes-core/flog")(i);e.LikesHelper=function(i,t){var o=e.mix({langBundles:["common","likes"],appContext:i},e.Localizable),l=new e.TemplateLibraryHelper(i,{localizeLib:o}),a={toggleLikeLocal:function(n,t){var o=t.engagementModel.getValue("id"),l=t.engagementModel,a=l.getValue("reactions").like;if(a.canReact)return i.getViewer().signedIn||this.showSignUpAndLikeModal(o,e.config.win.location.href),a=l.toggleReaction("like",n),n&&this.showFirstLikeModal(),a},updateReactionRemote:function(i){var t=this,o=i.engagementModel;o.getValue("reactions").like;return this.isUpdatingLike?e.Promise.resolve({}):(this.isUpdatingLike=!0,o.updateReactionRemote().then((function(e){return t.isUpdatingLike=!1,e})).catch((function(e){return n.error("Error liking photo",{err:e}),t.isUpdatingLike=!1,e})))},updateLikeEngagementItemNode:function(e,i){var n=e.one(".engagement-count");e.toggleClass("liked",i.didViewerReact),n&&(n.set("text",i.count),n.toggleClass("empty",0===i.count))},showSignUpAndLikeModal:function(n,t){var l,a=o.intlMessage({intlName:"likes.SIGN_IN_BEFORE_LIKE_TITLE"}),s=o.intlMessage({intlName:"likes.JOIN_FLICKR_AND_LIKE"});(l=new e.Views.SignUpModal({appContext:i,signUpHeaderClass:"signup-like",signUpTitle:a,signUpMessage:s,beaconPrefix:"like"})).on("signUpClick",(function(e){console.log("sign up pending LIKE")})),l.on("signInClick",(function(e){console.log("add pending LIKE")})),l.show()},showFirstLikeModal:function(){new e.Views.FluidModal({htmlMessage:l.getTemplate("first-like-modal")({url:"https://blog.flickr.net"}),appContext:i,classList:"first-like-modal-view",dismissOnOverlayClick:!0,showHeader:!1,showCancelX:!1,actionButtonLabel:o.intlMessage({intlName:"common.GOT_IT"}),showCancelButton:!1,width:500}).show()}};return e.augment(a,e.EventTarget),a}}),"@VERSION@",{requires:["event-custom","template-lib-helper","hermes-template-first-like-modal"],optionalRequires:["hermes-core"],langBundles:["common","likes"]});YUI.add("hermes-lang-likes_zh-hk",(function(e,a){e.Intl.add("hermes/likes","zh-HK",{LIKES_COUNT:[{type:6,value:"count",options:{one:{value:[{type:1,value:"countString"},{type:0,value:" like"}]},other:{value:[{type:1,value:"countString"},{type:0,value:" likes"}]}},offset:0,pluralType:"cardinal"}],LIKES_LABEL:[{type:6,value:"count",options:{one:{value:[{type:0,value:"like"}]},other:{value:[{type:0,value:"likes"}]}},offset:0,pluralType:"cardinal"}],"1_PERSON_LIKED_THIS":[{type:0,value:'<a class="person-link" href="'},{type:1,value:"personUrl"},{type:0,value:'">'},{type:1,value:"personName"},{type:0,value:"</a> liked this"}],YOU_LIKED_THIS:[{type:0,value:'<a class="you-link" href="'},{type:1,value:"youUrl"},{type:0,value:'">YOU</a> liked this'}],"2_PEOPLE_LIKED_THIS":[{type:0,value:'<a class="person-link" href="'},{type:1,value:"personUrl"},{type:0,value:'">'},{type:1,value:"personName"},{type:0,value:'</a> and <a class="person-2-link" href="'},{type:1,value:"person2Url"},{type:0,value:'">'},{type:1,value:"person2Name"},{type:0,value:"</a> liked this"}],YOU_AND_1_PERSON_LIKED_THIS:[{type:0,value:'<a class="you-link" href="'},{type:1,value:"youUrl"},{type:0,value:'">YOU</a> and <a class="person-2-link" href="'},{type:1,value:"person2Url"},{type:0,value:'">'},{type:1,value:"person2Name"},{type:0,value:"</a> liked this"}],X_PEOPLE_LIKED_THIS:[{type:0,value:'<a class="person-link" href="'},{type:1,value:"personUrl"},{type:0,value:'">'},{type:1,value:"personName"},{type:0,value:'</a>, <a class="person-2-link" href="'},{type:1,value:"person2Url"},{type:0,value:'">'},{type:1,value:"person2Name"},{type:0,value:'</a> and <a class="person-count-link" href="'},{type:1,value:"personCountUrl"},{type:0,value:'">'},{type:1,value:"personCountString"},{type:0,value:" more people</a> liked this"}],YOU_AND_X_PEOPLE_LIKED_THIS:[{type:0,value:'<a class="you-link" href="'},{type:1,value:"youUrl"},{type:0,value:'">YOU</a> and <a class="person-count-link" href="'},{type:1,value:"personCountUrl"},{type:0,value:'">'},{type:1,value:"personCountString"},{type:0,value:" more people</a> liked this"}],"1_PERSON_FAVED_THIS":[{type:0,value:'<a class="person-link" href="'},{type:1,value:"personUrl"},{type:0,value:'">'},{type:1,value:"personName"},{type:0,value:"</a> added this to Favorites"}],YOU_FAVED_THIS:[{type:0,value:'<a class="you-link" href="'},{type:1,value:"youUrl"},{type:0,value:'">YOU</a> added this to Favorites'}],"2_PEOPLE_FAVED_THIS":[{type:0,value:'<a class="person-link" href="'},{type:1,value:"personUrl"},{type:0,value:'">'},{type:1,value:"personName"},{type:0,value:'</a> and <a class="person-2-link" href="'},{type:1,value:"person2Url"},{type:0,value:'">'},{type:1,value:"person2Name"},{type:0,value:"</a> added this to Favorites"}],"3_PEOPLE_FAVED_THIS":[{type:0,value:'<a class="person-link" href="'},{type:1,value:"personUrl"},{type:0,value:'">'},{type:1,value:"personName"},{type:0,value:'</a>, <a class="person-2-link" href="'},{type:1,value:"person2Url"},{type:0,value:'">'},{type:1,value:"person2Name"},{type:0,value:'</a>, and <a class="person-2-link" href="'},{type:1,value:"person3Url"},{type:0,value:'">'},{type:1,value:"person3Name"},{type:0,value:"</a> added this to Favorites"}],YOU_AND_1_PERSON_FAVED_THIS:[{type:0,value:'<a class="you-link" href="'},{type:1,value:"youUrl"},{type:0,value:'">YOU</a> and <a class="person-2-link" href="'},{type:1,value:"person2Url"},{type:0,value:'">'},{type:1,value:"person2Name"},{type:0,value:"</a> added this to Favorites"}],X_PEOPLE_FAVED_THIS:[{type:0,value:'<a class="person-link" href="'},{type:1,value:"personUrl"},{type:0,value:'">'},{type:1,value:"personName"},{type:0,value:'</a>, <a class="person-2-link" href="'},{type:1,value:"person2Url"},{type:0,value:'">'},{type:1,value:"person2Name"},{type:0,value:'</a> and <a class="person-count-link" href="'},{type:1,value:"personCountUrl"},{type:0,value:'">'},{type:1,value:"personCountString"},{type:0,value:" more people</a> added this to Favorites"}],YOU_AND_X_PEOPLE_FAVED_THIS:[{type:0,value:'<a class="you-link" href="'},{type:1,value:"youUrl"},{type:0,value:'">YOU</a> and <a class="person-count-link" href="'},{type:1,value:"personCountUrl"},{type:0,value:'">'},{type:1,value:"personCountString"},{type:0,value:" more people</a> added this to Favorites"}],SIGN_IN_BEFORE_LIKE_TITLE:[{type:0,value:"You found a photo you like!"}],JOIN_FLICKR_AND_LIKE:[{type:0,value:"Join Flickr to like this photo."}],LIKES_MODAL_INSTRUCTIONS_1:[{type:0,value:"Click the [+] icon on a photo to save it to your Favorites and other galleries"}],LIKES_MODAL_INSTRUCTIONS_2:[{type:0,value:"Click the thumbs up icon to simply let the photographer know you like their photo."}],EXCITED_MODAL_HEADER:[{type:0,value:"Weâ€™re excited to introduce Likes!"}],LIKES_MODAL_DESC:[{type:0,value:"Likes are a new way to show appreciation on Flickr."}]})}),"@VERSION@",{requires:["intl"]});YUI.add("like-engagement-item-view",(function(e,i){var t=require("hermes-core/flog")(i);e.namespace("Views")[this.name]=e.Base.create("like-engagement-item-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(i){this.set("isActiveViewAgnostic",!0),this.config=this.processParams(i),this.photoCardHelper=new e.PhotoCardHelper(this.appContext),this.likesHelper=new e.LikesHelper(this.appContext,{}),this.signedIn=this.appContext.getViewer().signedIn},processParams:function(e){return{photoId:(e=Object.assign({engagementModelName:"photo-engagement-models"},e,e.subviewParams?e.subviewParams["like-engagement-item-view"]:{})).photoId,theme:e.theme,showCount:e.showCount,size:e.size,isPadded:e.isPadded,engagementModelName:e.engagementModelName}},loadState:function(){var e=this;return this.appContext.getModel(this.config.engagementModelName,this.config.photoId).then((function(i){e.engagementModel=i}))},buildContainer:function(){this.setContainerWithTemplate("like-engagement-item",Object.assign({engagement:this.photoCardHelper.convertEngagementModel(this.engagementModel)},this.config))},activate:function(){var e=this,i=this.get("container");this.likeNode=i.one(".like-engagement-item"),this.countNode=this.likeNode.one(".like-engagement-count"),this.registerEventHandler(this.likeNode.on("click",this.handleLikeClick.bind(this))),this.registerEventHandler(this.engagementModel.on("valuesChanged",(function(i){i.reactions&&e.reload()}))),this.fire("activated")},handleLikeClick:function(e){var i=this,n=i.engagementModel,o=n.getValue("reactions").like,s=o.didViewerReact;if(!this.isTogglingLike){if(!(o=this.likesHelper.toggleLikeLocal(!s,{engagementModel:n})))return;this.isTogglingLike=!0,this.likesHelper.updateLikeEngagementItemNode(this.likeNode,o),this.likesHelper.updateReactionRemote({engagementModel:n}).then((function(e){i.isTogglingLike=!1})).catch((function(e){if(i.isTogglingLike=!1,3!==e.code){var o=this.likesHelper.toggleLikeLocal(s,{engagementModel:n});i.likesHelper.updateLikeEngagementItemNode(i.likeNode,o)}t.error("Error liking photo",{err:e}),i.isTogglingLike=!1}))}},showCountNode:function(e){this.countNode.toggleClass("hidden",!e)},reload:function(){this.detachRegisteredEvents(),this.buildContainer(),this.activate()}})}),"@VERSION@",{requires:["flickr-view","hermes-template-like-engagement-item","likes-helper","photo-card-helper"],optionalRequires:["hermes-core"],langBundles:["common","likes"]});YUI.add("hermes-template-stuff-creation-view",(function(e,n){var t=e.Template.Handlebars.revive({1:function(e,n,t,l,a){return"large"},3:function(e,n,t,l,a){return'<div class="error-message create-error hidden"></div>'},compiler:[8,">= 4.3.0"],main:function(e,n,t,l,a){var i,o,r=null!=n?n:e.nullContext||{},c=e.hooks.helperMissing,s="function",u=e.escapeExpression,d=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'<div class="stuff-creation-container '+(null!=(i=d(t,"if").call(r,null!=n?d(n,"isLarge"):n,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:1,column:37},end:{line:1,column:64}}}))?i:"")+'">\n\t<header>\n\t\t<h1 class="stuff-creation-heading">'+u(typeof(o=null!=(o=d(t,"heading")||(null!=n?d(n,"heading"):n))?o:c)===s?o.call(r,{name:"heading",hash:{},data:a,loc:{start:{line:3,column:37},end:{line:3,column:48}}}):o)+'</h1>\n\t\t<svg class="close-x-button"><use xlink:href="#icon-close"></use></svg>\n\t</header>\n\t<div class="input-item title-input-item">\n\t\t<input class="input-field stuff-creation-title" type="text" placeholder="'+u(typeof(o=null!=(o=d(t,"placeholderTitle")||(null!=n?d(n,"placeholderTitle"):n))?o:c)===s?o.call(r,{name:"placeholderTitle",hash:{},data:a,loc:{start:{line:7,column:75},end:{line:7,column:95}}}):o)+'">\n\t\t<div class="error-message title-error"></div>\n\t</div>\n\t<textarea class="input-field stuff-creation-description" placeholder="'+u(typeof(o=null!=(o=d(t,"placeholderDescription")||(null!=n?d(n,"placeholderDescription"):n))?o:c)===s?o.call(r,{name:"placeholderDescription",hash:{},data:a,loc:{start:{line:10,column:71},end:{line:10,column:97}}}):o)+'"></textarea>\n\t<div class="create-footer">\n\t\t'+(null!=(i=d(t,"if").call(r,null!=n?d(n,"isLarge"):n,{name:"if",hash:{},fn:e.noop,inverse:e.program(3,a,0),data:a,loc:{start:{line:12,column:2},end:{line:12,column:77}}}))?i:"")+'\n\t\t<div class="buttons">\n\t\t\t'+(null!=(i=d(t,"if").call(r,null!=n?d(n,"isLarge"):n,{name:"if",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a,loc:{start:{line:14,column:3},end:{line:14,column:78}}}))?i:"")+'\n\t\t\t<button class="alt button mini button-cancel">'+u(typeof(o=null!=(o=d(t,"cancelText")||(null!=n?d(n,"cancelText"):n))?o:c)===s?o.call(r,{name:"cancelText",hash:{},data:a,loc:{start:{line:15,column:49},end:{line:15,column:63}}}):o)+'</button>\n\t\t\t<button class="button mini button-action">'+u(typeof(o=null!=(o=d(t,"actionText")||(null!=n?d(n,"actionText"):n))?o:c)===s?o.call(r,{name:"actionText",hash:{},data:a,loc:{start:{line:16,column:45},end:{line:16,column:59}}}):o)+"</button>\n\t\t</div>\n\t</div>\n</div>\n"},useData:!0}),l={};e.Array.each([],(function(n){var t=e.Template.get("hermes/"+n);t&&(l[n]=t)})),e.Template.register("hermes/stuff-creation-view",(function(n,a){return(a=a||{}).partials=a.partials?e.merge(l,a.partials):l,t(n,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("stuff-creation-view",(function(t,e){t.namespace("Views")[this.name]=t.Base.create("stuff-creation-view",t.FlickrView,[],{initializer:function(t){return this.params=t,this.heading=t.heading,this.placeholderTitle=t.placeholderTitle,this.placeholderDescription=t.placeholderDescription,this.cancelText=t.cancelText,this.actionText=t.actionText,this.inlineCreation=t.inlineCreation,this},buildContainer:function(){return this.setContainerWithTemplate("stuff-creation-view",{heading:this.heading,placeholderTitle:this.placeholderTitle,placeholderDescription:this.placeholderDescription,cancelText:this.cancelText,actionText:this.actionText,isLarge:this.params.useLargeLayout}),this},activate:function(){return this.isCreating=!1,this},showError:function(t,e,i){i&&t.set("text",i),e?t.removeClass("hidden"):t.addClass("hidden")},showTitleError:function(t,e){this.titleItemNode.toggleClass("error",t),e&&this.titleErrorNode.set("text",e)},destructor:function(){this.closeTimer&&clearTimeout(this.closeTimer)},resetView:function(){this.buildContainer(),this.activate()},createCuration:function(){var e=this;return this.isCreating?t.Promise.reject():(this.isCreating=!0,this.actionButton.setAttribute("disabled"),this.createNewAndAddPhoto().then((function(t){return e.isCreating=!1,e.actionButton.removeAttribute("disabled"),t})).catch((function(t){throw e.isCreating=!1,e.actionButton.removeAttribute("disabled"),t})))},focusInitial:function(){}})}),"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-stuff-creation-view"]});YUI.add("album-creation-view",(function(e,t){var o=require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create("album-creation-view",e.Views["stuff-creation-view"],[],{langBundles:this.details.langBundles,initializer:function(e){return this.usePhotoSelector=!1,this.appContext.flipper.isFlipped("enable-create-new-album-megamodal")&&(this.usePhotoSelector=e.usePhotoSelector||!1),e.heading=this.intlMessage({intlName:"add-to-stuff.CURATIONS_CREATE_A_NEW_ALBUM"}),e.placeholderTitle=this.intlMessage({intlName:"add-to-stuff.CURATIONS_ALBUM_NAME"}),e.placeholderDescription=this.intlMessage({intlName:"add-to-stuff.CURATIONS_DESCRIPTION_OPTIONAL"}),e.cancelText=this.intlMessage({intlName:"common.CANCEL"}),e.actionText=this.usePhotoSelector?this.intlMessage({intlName:"stats.NEXT"}):this.intlMessage({intlName:"global-nav.CREATE"}),this.photoId=e.photoId,this.dismissOnCreate=e.dismissOnCreateAlbum,this.curationType="album",this.photoIds=e.photoIds,this.titleError=this.intlMessage({intlName:"add-to-stuff.PLEASE_ENTER_ALBUM_NAME"}),this.createError=this.intlMessage({intlName:"add-to-stuff.COULDNT_SAVE_ALBUM"}),this.constructor.superclass.initializer.call(this,e)},activate:function(){var e=this.get("container");this.titleItemNode=e.one(".input-item.title-input-item"),this.titleErrorNode=e.one(".error-message.title-error"),this.createErrorNode=e.one(".error-message.create-error"),this.titleNode=e.one(".stuff-creation-title"),this.descriptionNode=e.one(".stuff-creation-description"),this.cancelButton=e.one(".button-cancel"),this.actionButton=e.one(".button-action"),this.closeButton=e.one(".close-x-button"),this.setupEvents(),this.constructor.superclass.activate.call(this,this.params)},setupEvents:function(){var e=this;this.get("container");this.registerEventHandler(this.titleNode.on("keyup",(function(){e.titleNode.get("value")&&e.showTitleError(!1)}))),this.registerEventHandler(this.cancelButton.on("click",(function(){e.fire("cancel"),e.usePhotoSelector?e.fire("readyToClose"):e.resetView()}))),this.registerEventHandler(this.closeButton.on("click",(function(){e.fire("readyToClose")}))),this.registerEventHandler(this.actionButton.on("click",(function(){e.usePhotoSelector?e.displayPhotoSelector():e.createCuration()})))},createNewAndAddPhoto:function(){var t,i=this,s=!!this.photoIds,n=this.titleNode.get("value"),r=this.descriptionNode.get("value");return n?(t={photoID:s?this.photoIds[0]:this.photoId,title:n,description:r,isMultiplePhotos:s,numberOfPhotosSelected:i.params.numberOfPhotosSelected,numberOfVideosSelected:i.params.numberOfVideosSelected},this.appContext.getModelRegistry("set-models").then((function(e){return i.albumsModel=e,e.remote.create(t,i.appContext)})).then((function(e){var t;return s&&(t=i.photoIds.slice(1)).length>0?i.addPhotos(e.getValue("id"),t).then((function(){return e})):e})).then((function(t){if(i.titleNode.set("value",""),i.descriptionNode.set("value",""),i.fire("created",{type:i.curationType,curation:t}),e.Snowplough){var o={id:t.id,photoIds:i.photoIds},s=e.Snowplough.getAlbumContext(o);e.Snowplough.sendStructuredEvent({category:"album",action:"created"},s)}return i.params.inlineCreation?i.resetView():i.params.usePhotoSelector?(i.photoSelectorModal.close(),e.fire("albumCreation:newAlbumCreated")):i.fire("readyToClose"),t})).catch((function(t){(o.error("Error handling photo addition after album creation",{err:t}),i.usePhotoSelector)&&(new e.Views.FluidModal({appContext:i.appContext,subview:new e.Views["confirmation-dialog-view"]({appContext:i.appContext,title:i.intlMessage({intlName:"common.OOPS"}),htmlMessage:t.message,showCancelButton:!1}),hasSubviewConfigRefactor:!0}).show(),i.photoSelectorView.confirmView.setButtonState({confirm:""}));throw t}))):(i.showTitleError(!0,i.titleError),e.Promise.reject({message:i.titleError}))},addPhotos:function(t,o){for(var i=this,s=[],n=[],r=0;r<o.length;r+=500)s.push(o.slice(r,r+500<o.length?r+500:o.length));return s.forEach((function(e,o){n.push(i.albumsModel.remote.addPhoto({photoID:e.join(","),isMultiplePhotos:!0,photosSelectedIds:i.params.photosSelectedIds,videosSelectedIds:i.params.videosSelectedIds,numberOfPhotosSelected:i.params.numberOfPhotosSelected,numberOfVideosSelected:i.params.numberOfVideosSelected,setID:t,updateItemCounts:0===o},this.appContext))})),e.Promise.all(n).then((function(e){return e&&e[0]?e[0].setModel:null}))},focusInitial:function(){this.titleNode&&this.titleNode.focus()},displayPhotoSelector:function(){this.titleNode.get("value")?(this.fire("readyToClose"),this.photoSelectorView=new e.Views["photo-selector-view"]({appContext:this.appContext,enableMultiSelect:!0,enableVideos:!0,multiSelectLimit:e.config.flickr.api.max_photos_in_photoset,searchable:{yours:!0},navBarConfig:{links:[{id:"photostream",name:this.intlMessage({intlName:"common.PHOTOSTREAM"}),value:"photostream",selected:!0},{id:"sets",name:this.intlMessage({intlName:"common.ALBUMS"}),value:"sets"}],enableSearch:!0,breakpointConfig:[{maxWidth:700,enableSearch:!1},{maxWidth:500,enableSearch:!1}],onClose:e=>{this.photoSelectorModal.close()}},initialButtonState:{confirm:"disabled"},onConfirm:e=>{this.handlePhotoSelectorConfirm(e)}}),this.photoSelectorModal=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,showCancelButton:!1,actionButtonDisabled:!0,subview:this.photoSelectorView,width:Math.round(.8*Math.max(1280,e.config.win.innerWidth)),height:Math.round(e.config.win.innerHeight-60),fullWindow:!0,hasSubviewConfigRefactor:!0,flexLayout:!0,classList:"photo-selector"}).show(),this.photoSelectorView.registerEventHandler(e.on("photoSelector:selected",(()=>{this.photoSelectorView.confirmView.setButtonState({confirm:""})}))),this.photoSelectorView.registerEventHandler(e.on("photoSelector:unselected",(e=>{e.wasLastPhotoSelected&&this.photoSelectorView.confirmView.setButtonState({confirm:"disabled"})})))):this.showTitleError(!0,this.titleError)},handlePhotoSelectorConfirm:function(){this.photoSelectorView.confirmView.setButtonState({confirm:"loading"});var e=this.photoSelectorView.get("selectionModel").getValue("photos"),t=!1,o=[],i=[];this.photoId="",this.photoIds=[],e.getList().forEach(((e,s)=>{let n=e.getValue("id");this.photoIds.push(n),e.getValue("isVideo")?(o.push(n),0===s&&(t=!0)):i.push(n)})),this.photoId=this.photoIds[0],this.params.photosSelectedIds=i,this.params.videosSelectedIds=o,this.params.numberOfPhotosSelected=i.length,this.params.numberOfVideosSelected=o.length,t?this.params.numberOfVideosSelected--:this.params.numberOfPhotosSelected--,this.createNewAndAddPhoto()}})}),"@VERSION@",{requires:["flickr-view","stuff-creation-view"],optionalRequires:["hermes-core"],optional:["set-models"],langBundles:["more-menu-view","common","global-nav","add-to-stuff","profile","stats"]});